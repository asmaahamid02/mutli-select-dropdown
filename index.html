<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-select Dropdown</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
      }
    </script>
  </head>

  <body
    class="bg-gray-100 dark:bg-gray-800 flex flex-col items-center justify-center h-screen"
  >
    <form class="w-1/3 relative">
      <div
        class="multi-select-wrapper border py-2 pl-2 pr-6 relative min-h-12 flex flex-wrap border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 dark:text-gray-300 rounded-md shadow-sm cursor-text"
      >
        <span class="chips-container cursor-default"> </span>
        <span class="multi-select-input-box w-auto">
          <input
            size="18"
            type="text"
            tabindex="1"
            autocomplete="off"
            role="combobox"
            aria-controls="categories"
            aria-disabled="false"
            aria-expanded="false"
            class="multi-select-input h-10 p-2 text-sm text-gray-800 focus:outline-none bg-white dark:bg-gray-900 indent-0 dark:text-gray-300 placeholder:text-xs"
            placeholder="Select category"
          />
        </span>
        <button
          class="clear-selection absolute right-1 bottom-2 font-medium hidden p-1 inline-flex items-center rounded-sm text-lg text-gray-400 bg-transparent hover:text-gray-900 dark:hover:text-gray-300"
          aria-label="Clear"
        >
          <svg
            class="w-3 h-3"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 14 14"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
            />
          </svg>
          <span class="sr-only">Clear Selection</span>
        </button>
        <select
          class="multi-select-selections hidden"
          multiple
          tabindex="-1"
          aria-hidden="true"
          name="categories[]"
        ></select>
      </div>
      <div
        class="multi-select-list-wrapper bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg shadow-md pr-2 absolute z-10 mt-1 left-0 right-0 hidden"
      >
        <ul
          id="categories"
          class="multi-select-list flex flex-col max-h-48 overflow-y-auto text-gray-700 dark:text-gray-300"
        >
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Appetizer"
          >
            Appetizer
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Beef"
          >
            Beef
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Bread"
          >
            Bread
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Breakfast"
          >
            Breakfast
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Cakes"
          >
            Cakes
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Chicken"
          >
            Chicken
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Desserts"
          >
            Desserts
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Drinks"
          >
            Drinks
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Main Dishes"
          >
            Main Dishes
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Pasta"
          >
            Pasta
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Pizza"
          >
            Pizza
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Salads"
          >
            Salads
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Seafood"
          >
            Seafood
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Smoothies"
          >
            Smoothies
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Soups"
          >
            Soups
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Vegan"
          >
            Vegan
          </li>
          <li
            class="multi-select-item py-2 pl-3 pr-2 mr-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
            data-value="Vegetarian"
          >
            Vegetarian
          </li>

          <li
            class="not-found py-2 pl-3 pr-2 mr-2 cursor-default text-center hidden"
          >
            No items found
          </li>
        </ul>
      </div>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        //Show/Hide the dropdown list
        $('.multi-select-wrapper').on('click', function (e) {
          if (
            $(e.target).closest('.chips-container').length ||
            $(e.target).closest('.clear-selection').length
          )
            return

          $('.multi-select-input').focus()
        })

        $('.multi-select-input').on('focus', function () {
          $('.multi-select-list-wrapper').show()
        })

        $('.multi-select-input').on('blur', function () {
          setTimeout(function () {
            $('.multi-select-list-wrapper').hide()
          }, 200)
        })

        //Select item
        $('.multi-select-item').on('click', function () {
          if ($(this).hasClass('not-found')) return

          const value = $(this).data('value')
          const text = $(this).text()
          const foundChip = $('.chips-container').find(
            `[data-value='${value}']`
          )
          const foundSelection = $('.multi-select-selections').find(
            `[value='${value}']`
          )

          //add if not found
          if (foundChip.length <= 0) {
            const chip = `
                        <span class="chip-item inline-flex items-center rounded bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 px-2 py-1 me-2 mb-1 gap-1" data-value="${value}">
                            <span class="chip-content truncate text-sm">${text}</span>
                            <button class="chip-remove ms-2 p-1 inline-flex items-center rounded-sm text-sm text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 dark:hover:bg-gray-600 dark:hover:text-gray-300" aria-label="Remove">                        
                                <svg class="w-2 h-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                                </svg>
                                <span class="sr-only">Remove badge</span>
                            </button>
                        </span>
                        `

            $('.chips-container').append(chip)
            $(this).addClass('bg-gray-100 dark:bg-gray-800')

            //append to select
            const select = $('.multi-select-selections')
            const option = `<option value="${value}" selected>${text}</option>`
            select.append(option)
          } else {
            //remove selection if found
            $(this).removeClass('bg-gray-100 dark:bg-gray-800')
            foundSelection.remove()
            foundChip.remove()
          }

          $('.multi-select-input').val('')
          $('.multi-select-item').removeClass('hidden')
          $('.multi-select-list-wrapper').hide()

          //check if there are selected items
          checkEmptySelection()
        })

        //Search items
        $('.multi-select-input').on('keyup', function (e) {
          if (
            e.key === 'Backspace' &&
            $(this).val() == '' &&
            $('.chips-container').children().length > 0
          ) {
            handleBackSpaceKey(e)
            return
          }

          const value = $(this).val().toLowerCase()
          //check if there are items
          $('.multi-select-item').each(function () {
            const text = $(this).text().toLowerCase()
            if (text.indexOf(value) > -1) {
              $(this).removeClass('hidden')
            } else {
              $(this).addClass('hidden')
            }
          })

          //check if there are no items
          if ($('.multi-select-item:not(.hidden)').length <= 0) {
            $('.not-found').removeClass('hidden')
          } else {
            $('.not-found').addClass('hidden')
          }
        })

        //Clear selection
        $(document).on('click', '.clear-selection', function (e) {
          e.preventDefault()
          $('.chips-container').html('')
          $('.multi-select-input')
            .val('')
            .attr('placeholder', 'Select category')
            .attr('size', '18')
          $('.multi-select-selections').html('')
          $('.multi-select-item').removeClass(
            'bg-gray-100 dark:bg-gray-800 hidden'
          )
          $(this).hide()
        })

        //Remove chip
        $(document).on('click', '.chip-remove', function (e) {
          e.preventDefault()
          const value = $(this).parent().data('value')
          $('.multi-select-item').each(function () {
            if ($(this).data('value') == value) {
              $(this).removeClass('bg-gray-100 dark:bg-gray-800')
            }
          })
          $('.multi-select-selections').find(`[value='${value}']`).remove()
          $(this).parent().remove()

          checkEmptySelection()
        })

        //Check if there are selected items to handle input and clear button states
        function checkEmptySelection() {
          if ($('.chips-container').children().length > 0) {
            $('.clear-selection').show()
            $('.multi-select-input').attr('placeholder', '').attr('size', '4')
          } else {
            $('.clear-selection').hide()
            $('.multi-select-input')
              .attr('placeholder', 'Select category')
              .attr('size', '18')
          }
        }

        function handleBackSpaceKey(e) {
          const lastChip = $('.chips-container').children().last()
          const value = lastChip.data('value')
          $('.multi-select-item').each(function () {
            if ($(this).data('value') == value) {
              $(this).removeClass('bg-gray-100 dark:bg-gray-800')
            }
          })
          $('.multi-select-selections').find(`[value='${value}']`).remove()
          lastChip.remove()
          checkEmptySelection()
        }
      })
    </script>
  </body>
</html>
